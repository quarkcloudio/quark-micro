// Code generated by hertz generator.

package handler

import (
	"context"
	"log"
	"time"

	"github.com/cloudwego/hertz/pkg/app"
	"github.com/cloudwego/kitex/client"
	"github.com/cloudwego/kitex/client/callopt"
	"github.com/quarkcms/quark-hertz/cmd/admin/rpc/kitex_gen/admin"
	"github.com/quarkcms/quark-hertz/cmd/admin/rpc/kitex_gen/admin/resourceindex"
	"github.com/quarkcms/quark-hertz/pkg/msg"
)

// 资源列表
func ResourceIndex(ctx context.Context, c *app.RequestContext) {
	resource := c.Param("resource")
	if resource == "" {
		c.JSON(200, msg.Error("参数错误", ""))
		return
	}

	requestClient, err := resourceindex.NewClient("resourceindex", client.WithHostPorts("0.0.0.0:8888"))
	if err != nil {
		log.Fatal(err)
	}

	query := c.Request.QueryString()
	body, err := c.Body()
	if err != nil {
		log.Fatal(err)
	}

	req := &admin.ResourceIndexRequest{
		Request: &admin.Request{
			Query: query,
			Body:  body,
		},
		Resource: resource,
	}
	resp, err := requestClient.ResourceIndexhandle(context.Background(), req, callopt.WithRPCTimeout(3*time.Second))
	if err != nil {
		log.Fatal(err)
	}

	c.JSON(200, msg.Success("操作成功", "", resp.RespBody))
}
